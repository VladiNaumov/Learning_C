/* signal.c

   Реализация signal() с использованием sigaction().

   Компиляция с флагом "-DOLD_SIGS" обеспечивает старую, ненадежную семантику обработчика сигнала
   (которые всё ещё являются стандартом в некоторых производных системах от System V).
*/

/* Некоторые реализации UNIX следуют семантике сигнала BSD, включая
   Linux, Tru64, а также производные от BSD. Другие, такие как Solaris,
   следуют семантике System V. Мы условно переопределим signal() на
   платформах, использующих семантику System V. Для других реализаций
   мы предоставим пустой исходный файл, который не реализует signal().
*/
#if defined(__sun) || defined(__sgi)
#include <signal.h>

typedef void (*sighandler_t)(int);

sighandler_t
signal(int sig, sighandler_t handler)
{
    struct sigaction newDisp, prevDisp;

    newDisp.sa_handler = handler;
    sigemptyset(&newDisp.sa_mask);
#ifdef OLD_SIGNAL
    newDisp.sa_flags = SA_RESETHAND | SA_NODEFER;
#else
    newDisp.sa_flags = SA_RESTART;
#endif

    if (sigaction(sig, &newDisp, &prevDisp) == -1)
        return SIG_ERR;
    else
        return prevDisp.sa_handler;
}

#else
/* Следующее объявление предоставлено исключительно для предотвращения предупреждений gcc
   "warning: ISO C forbids an empty source file". */

extern int signalDummyVar;

#endif
/*

### Объяснение:

1. **Описание программы**:
   - Программа реализует функцию `signal()`, используя `sigaction()`, что является более надежным способом обработки сигналов.
   - Она проверяет, какая платформа используется (определяется через макросы `__sun` или `__sgi`), и в зависимости от этого либо реализует собственный обработчик сигнала, либо оставляет пустую заглушку для других платформ.

2. **Платформы с семантикой System V**:
   - Для платформ, таких как Solaris и SGI, используется старый механизм обработки сигналов. Если компиляция происходит с флагом `-DOLD_SIGS`, то будет применена старая семантика сигналов.
   - В этих платформах функция `signal()` настраивает обработчик сигнала с флагами `SA_RESETHAND` и `SA_NODEFER` (если используется старая семантика) или `SA_RESTART` для более новых стандартов.

3. **Для других платформ**:
   - Для других платформ, использующих семантику BSD (например, Linux), этот файл не будет содержать реализацию `signal()`, а будет определён только пустой внешний объект (`signalDummyVar`), чтобы избежать предупреждений компилятора о пустом исходном файле.
   
*/