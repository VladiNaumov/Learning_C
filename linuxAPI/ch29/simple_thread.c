/* simple_thread.c

   Простой пример использования POSIX-потоков: создаем поток и выполняем с ним join.
*/

#include <pthread.h>  // Для работы с POSIX-потоками
#include "tlpi_hdr.h" // Библиотека заголовков для вспомогательных функций (ошибки и т. д.)

/* Функция, которая будет выполняться в потоке */
static void *threadFunc(void *arg) {
    char *s = arg;  // Получаем переданный аргумент как строку

    printf("%s", s);  // Выводим строку на экран

    return (void *) strlen(s);  // Возвращаем длину строки в качестве результата
}

int main(int argc, char *argv[]) {
    pthread_t t1;  // Переменная для идентификатора потока
    void *res;     // Переменная для получения результата потока
    int s;         // Код возврата функций pthread

    /* Создаем новый поток */
    s = pthread_create(&t1, NULL, threadFunc, "Hello world\n");  // Аргумент: строка "Hello world\n"
    if (s != 0)
        errExitEN(s, "pthread_create");  // Если произошла ошибка, выводим сообщение

    printf("Message from main()\n");  // Сообщение из главного потока

    /* Ожидаем завершения потока */
    s = pthread_join(t1, &res);
    if (s != 0)
        errExitEN(s, "pthread_join");  // Если произошла ошибка, выводим сообщение

    /* Выводим результат, возвращенный потоком */
    printf("Thread returned %ld\n", (long) res);

    exit(EXIT_SUCCESS);  // Завершаем программу с успешным статусом
}

/*
Краткое объяснение:
1. Программа создает поток, передавая ему функцию `threadFunc()` и строку "Hello world\n" в качестве аргумента.
2. Поток выводит строку и возвращает её длину.
3. Главный поток (main) ожидает завершения потока через `pthread_join()` и выводит результат, возвращенный потоком.
4. `pthread_create` и `pthread_join` проверяются на ошибки, чтобы обеспечить надежную обработку.
*/
