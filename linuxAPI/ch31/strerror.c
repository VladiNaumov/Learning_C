/* strerror.c

   Реализация функции strerror(), которая не является потокобезопасной.
*/

#define _GNU_SOURCE  /* Подключает '_sys_nerr' и '_sys_errlist' из <stdio.h> */
#include <stdio.h>
#include <string.h>   /* Подключает объявление strerror() */

#define MAX_ERROR_LEN 256  /* Максимальная длина строки, возвращаемой strerror() */

/* Статически выделенный буфер для возвращаемой строки */
static char buf[MAX_ERROR_LEN];

/* 
 * strerror: Возвращает строку с описанием ошибки на основе её кода.
 * 
 * Параметры:
 *   err - код ошибки.
 * 
 * Возвращает:
 *   Указатель на строку с описанием ошибки.
 * 
 * Примечание:
 *   Реализация не потокобезопасна, так как использует общий статический буфер.
 */
char *strerror(int err) {
    /* Проверка допустимости кода ошибки */
    if (err < 0 || err >= _sys_nerr || _sys_errlist[err] == NULL) {
        /* Если код ошибки недопустим, возвращаем сообщение об ошибке */
        snprintf(buf, MAX_ERROR_LEN, "Unknown error %d", err);
    } else {
        /* Копируем описание ошибки из _sys_errlist */
        strncpy(buf, _sys_errlist[err], MAX_ERROR_LEN - 1);
        buf[MAX_ERROR_LEN - 1] = '\0';  /* Гарантируем нуль-терминацию */
    }

    return buf;
}

/* 
 * Резюме:
 * 
 * Эта реализация функции strerror() возвращает строку, описывающую ошибку на основе её кода.
 * Если код ошибки некорректен, возвращается строка "Unknown error <код>".
 * Недостаток реализации в том, что она не потокобезопасна, поскольку все вызовы используют
 * один общий статический буфер для хранения результата.
 */
