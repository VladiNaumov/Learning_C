/* show_secbits.c

   Эта программа показывает значения "securebits" процесса.

   Программа использует системный вызов prctl с параметром PR_GET_SECUREBITS для получения текущего значения securebits, которое указывает на набор флагов безопасности для процесса.

*/

#include <sys/prctl.h>
#include "cap_functions.h"  // Предполагается, что здесь определены функции для работы с security bits
#include "tlpi_hdr.h"        // Включает обработку ошибок и стандартные библиотеки

int main(int argc, char *argv[])
{
    // Получаем значение securebits для текущего процесса
    int secbits = prctl(PR_GET_SECUREBITS, 0, 0, 0, 0);
    if (secbits == -1)
        errExit("prctl");  // В случае ошибки выводим сообщение и завершаем программу

    // Выводим значение в шестнадцатеричном виде
    printf("secbits = 0x%x => ", secbits);

    // Используем функцию printSecbits для печати состояния securebits
    printSecbits(secbits, argc == 1, stdout);  // argc == 1 проверяет, был ли передан аргумент для вывода
    printf("\n");

    exit(EXIT_SUCCESS);  // Завершаем программу
}

/*

### Объяснение кода:
1. **prctl(PR_GET_SECUREBITS, 0, 0, 0, 0)**:
   - Этот системный вызов используется для получения текущих значений "securebits" процесса.
   - Возвращает значение, которое представляет собой флаги безопасности процесса.

2. **Печать значения `secbits`**:
   - Значение `secbits` выводится в шестнадцатеричном формате, а затем через функцию `printSecbits` происходит более детализированный вывод, который интерпретирует эти флаги.

3. **printSecbits**:
   - Эта функция, вероятно, является частью `cap_functions.h` и используется для детализированного вывода значения securebits в понятном виде.

4. **Использование**:
   - Пример вызова:
     ```bash
     ./show_secbits
     ```
   - Программа выводит значение securebits для текущего процесса.

5. **Ошибки**:
   - В случае ошибки системного вызова `prctl`, программа завершится с вызовом `errExit("prctl")`, выводя соответствующее сообщение.
*/